---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";

import { replaceWithSpan } from "@/lib/utils";

import ProjectCard from "@/components/ui/ProjectCard.astro";
import TechBadge from "@/components/ui/TechBadge.astro";
import MainLayout from "@/layouts/MainLayout.astro";

export async function getStaticPaths() {
  const projects = await getCollection("projects");

  return projects.map((project) => ({
    params: { project: project.data.slug },
    props: { project: project.data },
  }));
}

const { project } = Astro.props;

const allProjects = await getCollection("projects");

const restOfProjects = allProjects
  .filter((p) => p.data.slug !== project.slug)
  .map((p) => p.data);
---

<MainLayout>
  <div class="border-b border-color">
    <section
      class="max-w-[1024px] mx-auto pt-32 pb-16 border-x border-color px-10"
    >
      <header
        class="flex flex-col-reverse md:flex-row gap-y-5 md:gap-y-0 md:gap-x-2 justify-between"
      >
        <div class="space-y-5 md:w-1/2">
          {
            project.demo ? (
              <h1 class="text-5xl font-semibold">
                <a href={project.demo} target="_blank" rel="noreferrer">
                  {project.title}
                </a>
              </h1>
            ) : (
              <h1 class="text-5xl font-semibold">{project.title}</h1>
            )
          }
          <p
            set:html={replaceWithSpan(project.description, {
              className: "font-semibold",
            })}
          />

          <ul class="flex gap-x-5 gap-y-2 flex-wrap">
            {project.tech.map((tech) => <TechBadge text={tech} />)}
          </ul>
        </div>
        <Image
          transition:name={`${project.slug}-image`}
          src={project.images.principal}
          alt="project"
          class="aspect-video rounded-lg object-cover md:w-1/2"
          width={800}
          height={450}
        />
      </header>
      <div class="pt-16 space-y-5">
        {
          project.images.rest.map((image) => (
            <Image
              transition:name={`${project.slug}-image`}
              src={image}
              alt="project"
              class="aspect-[16/8] rounded-lg object-cover mx-auto"
              width={800}
              height={450}
            />
          ))
        }
      </div>
    </section>
    <div class="w-full border-b border-color"></div>
    <section
      class="max-w-[1024px] mx-auto border-x border-color py-16 px-10 space-y-10"
    >
      <h3 class="text-3xl font-semibold text-center">MÃ¡s Proyectos</h3>

      <ul class="grid grid-cols-1 md:grid-cols-2 gap-5">
        {
          restOfProjects.map((project) => (
            <ProjectCard
              title={project.title}
              slug={project.slug}
              image={project.images.principal}
              shortDescription={project.short_description}
            />
          ))
        }
      </ul>
    </section>
  </div>
</MainLayout>
